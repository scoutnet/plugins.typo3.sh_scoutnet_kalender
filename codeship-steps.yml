- name: run test
  service: ci_host
  command: bash -c "cd /opt/typo3; composer add_vcs '/opt/sh_scoutnet_kalender'; composer require scoutnet/sh-scoutnet-kalender --prefer-source; vendor/bin/phpunit --color -c web/typo3conf/ext/sh_scoutnet_kalender/Tests/Builds/UnitTests.xml"

- name: run php lint
  service: ci_host
  command: bash -c "cd /opt/sh_scoutnet_kalender; find . -name \*.php | parallel --gnu php -d display_errors=stderr -l {} > /dev/null"

- name: check_version
  tag: ^[0-9]+[.][0-9]+[.][0-9]+$
  service: build_host
  command: bash -c "cd /opt/data; make checkVersion"

- name: release to Github
  tag: ^[0-9]+[.][0-9]+[.][0-9]+$
  service: build_host
  command: bash -c "cd /opt/data; make release"

- name: build
  tag: ^[0-9]+[.][0-9]+[.][0-9]+$
  service: build_host
  command: bash -c "cd /opt/data; make deploy"

